<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel='stylesheet', href='/stylesheets/jobs.css' />
    <script src="/jsDic/ajax.js"></script>
    <title>Title</title>
</head>
<body>
<h1>职位管理</h1>

<div>
    <div class="cellBackSty" onclick="updataImg(this)">
        <b class="titleSty" id="10">企业图片:  </b>
        <div class="imgSty"  id="1-10"/>点击上传图片</div>
    </div>
    <div class="cellBackSty">
        <b class="titleSty" id="0">公司名称:  </b>
        <input type="text" placeholder="请输入公司名称" onblur="endEdit(this.value,0)" id="1-0"/>
    </div>
    <div class="cellBackSty">
        <p class="titleSty" id="1">公司描述:  </p>
        <textarea class="textAreSty"  placeholder="请输入公司简介" onblur="endEdit(this.value,1)" id="1-1"></textarea>
    </div>
    <div class="cellBackSty">
        <b class="titleSty" id="2">职位名称:  </b>
        <input type="text" placeholder="请输入职位名称" onblur="endEdit(this.value,2)" id="1-2"/>
    </div>
    <div class="cellBackSty">
        <p class="titleSty" id="3">职位描述:  </p>
        <textarea class="textAreSty" placeholder="请输入职位描述" onblur="endEdit(this.value,3)" id="1-3"></textarea>
    </div>
    <div class="cellBackSty">
        <b class="titleSty" id="4">最低学历要求:  </b>
        <input type="text" placeholder="请输入最低学历要求" onblur="endEdit(this.value,4)" id="1-4"/>
    </div>
    <div class="cellBackSty">
         <b class="titleSty" id="12">最低工作年限要求:  </b>
        <input type="text" placeholder="请输入最低工作年限要求" onblur="endEdit(this.value,12)" id="1-12"/>
    </div>
    <div class="cellBackSty">
        <b class="titleSty" id="5">公司地址:  </b>
        <input type="text" placeholder="请输入公司地址" onblur="endEdit(this.value,5)" id="1-5"/>
    </div>
    <div class="cellBackSty">
        <b class="titleSty" id="6">工作地点:  </b>
        <input type="text" placeholder="请输入作地点" onblur="endEdit(this.value,6)" id="1-6"/>
    </div>
    <div class="cellBackSty">
        <b class="titleSty" id="7">面试地点:  </b>
        <input type="text" placeholder="请输入面试地点" onblur="endEdit(this.value,7)" id="1-7"/>
    </div>
    <div class="cellBackSty">
         <b class="titleSty" id="13">面试截止日期:  </b>
         <input type="text" placeholder="请输入面试地截止日期:(如05-08 上午)" style="width: 280px" onblur="endEdit(this.value,13)" id="1-13"/>
    </div>
    <div class="cellBackSty">
        <b class="titleSty" id="8">薪资范围:  </b>
        <input type="text" placeholder="请输入薪资范围" onblur="endEdit(this.value,8)" id="1-8"/>
    </div>
    <div class="cellBackSty">
        <b class="titleSty" id="9">公司福利:  </b>
        <b style="margin-left: 20px;color: green" id="1-9"></b>
        <div id ='wellArrId' class="wellArrDivSty"></div>
    </div>
    <div class="cellBackSty">
        <b class="titleSty" id="11">默认申请人数(最终显示的申请人数=默认申请人数+真实申请人数):  </b>
        <input type="text" placeholder="请输入默认申请人数" onblur="endEdit(this.value,11)" id="1-11"/>
    </div>
    <button style="font-size: 24px;margin-left: 100px;margin-top: 20px;" onclick="subMit()">提交</button>
</div>
<script type="text/javascript">
    var administeratorId ='';
    var defwellArr = ['五险一金','全款皮肤','定期体检','绩效奖金','季度旅游','美女如云','工作餐','提供住宿','交通补贴','出差补贴','节日福利'];
    var json = '<%-JSON.stringify(obj)%>';
    var jsonDic = JSON.parse(json);
    var dataArr = [];
    dataArr[14] = '';
    dataArr[9] = []
    createWellCell()
    if(jsonDic){
        handelData();
        administeratorId = jsonDic.AdministratorId;
    }else {
        var a_ = GetRequest();
        administeratorId = a_['administeratorId'];

        //后期注释掉
        dataArr[10] = 'https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=1894384757,2976799759&fm=27&gp=0.jpg'
        endEdit(dataArr[10],10);
        var htmlId = '1-' +10;
        var html_ = document.getElementById(htmlId);
        html_.style.backgroundImage = "url('" +dataArr[10] +"')";
        html_.style.backgroundSize = 'cover'
    }
    function handelData() {
        dataArr[0] = jsonDic.companyName;
        dataArr[1] = jsonDic.companyDescrie;
        dataArr[2] = jsonDic.jobName;
        dataArr[3] = jsonDic.jobDescribe;
        dataArr[4] = jsonDic.minEducation;
        dataArr[5] = jsonDic.workAddress;
        dataArr[6] = jsonDic.workAddress;
        dataArr[7] = jsonDic.interViewAddress;
        dataArr[8] = jsonDic.salary;
        dataArr[9] = jsonDic.wellArr;
        dataArr[10] = jsonDic.companyImgUrl;
        dataArr[11] = jsonDic.applyNum;
        dataArr[12] = jsonDic.minWorkExperience;
        dataArr[13] = jsonDic.interviewTimes;
        for(var i = 0; i <dataArr.length -1;i ++){
            endEdit(dataArr[i],i);
            var htmlId = '1-' +i;
            var html_ = document.getElementById(htmlId);
            if (i == 10){
                html_.style.backgroundImage = "url('" +dataArr[i] +"')";
                html_.style.backgroundSize = 'cover'
            }else if(i == 9){
                html_.innerHTML = dataArr[i];
            }else {
                html_.value = dataArr[i];
            }
        }
        for(var i =0;i <jsonDic.wellArr.length;i ++){
           wellChooesd(jsonDic.wellArr[i],true);
        }
    }
    function endEdit(e,index) {
        if(e && e.length >0 || ((typeof e) == 'number')&& e>0){
            classChanged(index,true)
        }else {
            classChanged(index,false)
        }
        dataArr[index]  = e;
    }
    function classChanged(index,IsAdjective) {
        var title = document.getElementById(index);
        title.style.color = IsAdjective?'green':'red';
    }

    function createWellCell() {
        var div = document.getElementById('wellArrId')
        for(var i =0;i <defwellArr.length; i ++){
            var cell = document.createElement('button');
            cell.innerHTML = defwellArr[i];
            cell.style.margin = '10px';
            cell.setAttribute('id',defwellArr[i]);
            div.appendChild(cell);
            cell.onclick = function () {
                if(this.style.borderWidth == '1px'){
                    wellChooesd(this.id,true);
                    var index = dataArr[9].indexOf(this.id);
                    if(index <0){
                        dataArr[9].push(this.id);
                    }
                }else {
                    wellChooesd(this.id,false);
                    var index = dataArr[9].indexOf(this.id);
                    if(index >-1){
                        dataArr[9].splice(index,1);
                    }
                }
                var wellStr = document.getElementById('1-9');
                wellStr.innerHTML = dataArr[9];
                if(dataArr[9].length == 0){
                    classChanged(9,false);
                }else {
                    classChanged(9,true);
                }
            }
            wellChooesd(defwellArr[i],false)
        }
    }

    function wellChooesd(btnId,isChooesd) {
        var wellBtn = document.getElementById(btnId);
        if (wellBtn){
            if(isChooesd){
                wellBtn.style.borderColor = 'green';
                wellBtn.style.color = 'green'
                wellBtn.style.borderWidth = '2px'
                wellBtn.style.backgroundColor = '#db8621'
            }else {
                wellBtn.style.borderColor = '#999999';
                wellBtn.style.color = '#999999'
                wellBtn.style.borderWidth = '1px'
                wellBtn.style.backgroundColor = 'white'
            }
        }
    }

    function subMit() {
        var alertStr = '';
        for(var i=0;i <dataArr.length -1;i ++){
            if(!dataArr[i]){
                var title = document.getElementById(i);
                var str = title.innerHTML;
                str = str.substring(0,str.length -3);
                alertStr = str+'不能为空';
                break;
            }
        }
        if(alertStr.length >0){
            alert(alertStr);
            return;
        }
        var params = {
            companyName:dataArr[0],
            companyDescrie:dataArr[1],
            jobName:dataArr[2],
            jobDescribe:dataArr[3],
            minEducation:dataArr[4],
            workAddress:dataArr[5],
            interViewAddress:dataArr[7],
            salary:dataArr[8],
            wellArr:JSON.stringify(dataArr[9]),
            companyImgUrl:dataArr[10],
            applyNum:dataArr[11],
            minWorkExperience:dataArr[12],
            interviewTimes:dataArr[13],
            AdministratorId:administeratorId,
            type:1
        }
        if(jsonDic && jsonDic.jobId){
            params['jobId'] = jsonDic.jobId;
        }
        ajax({
            method:'POST',
            url:'http://localhost:3000/jobs/jobDetail',
            data:params,
            success:function (res) {
                var obj = JSON.parse(res);
                console.log(obj)
                if(obj.code ==0){
                  //  alert(obj.msg)
                    setTimeout(function () {
                        window.location.href = 'http://localhost:3000/admin/joblist?administratorId='+administeratorId;
                    },1500)
                }else {
                    alert(obj.msg);
                }
            }
        })
    }

    function updataImg(view) {
        setImagePreview();
    }

    function setImagePreview() {
        var docObj = document.getElementById("doc");
        var imgObjPreview = document.getElementById("preview");
        if (docObj.files && docObj.files[0]) {
            //火狐下，直接设img属性
            imgObjPreview.style.display = 'block';
            imgObjPreview.style.width = '300px';
            imgObjPreview.style.height = '500px';
            imgObjPreview.style.margin = 'auto';
            //imgObjPreview.src = docObj.files[0].getAsDataURL();
            //火狐7以上版本不能用上面的getAsDataURL()方式获取，需要一下方式
            imgObjPreview.src = window.URL.createObjectURL(docObj.files[0]);
        } else {
            //IE下，使用滤镜
            docObj.select();
            var imgSrc = document.selection.createRange().text;
            var localImagId = document.getElementById("localImag");
            //必须设置初始大小
            localImagId.style.width = "300px";
            localImagId.style.height = "120px";
            //图片异常的捕捉，防止用户修改后缀来伪造图片
            try {
                localImagId.style.filter = "progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale)";
                localImagId.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src = imgSrc;
            } catch (e) {
                alert("您上传的图片格式不正确，请重新选择!");
                return false;
            }
            imgObjPreview.style.display = 'none';
            document.selection.empty();
        }
    }
</script>
</body>
</html>